<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/core-localstorage/core-localstorage.html">

<polymer-element name="discussions-page" attributes="user" layout vertical>
  <template>
    <style>
      :host {
        display: block;
      }
      .item {
        margin: 1em;
      }

      .card {
        width: 300px;
        background-color: #fff;
        padding: 1em;
        position: relative;
      }
    </style>
    <core-localstorage id="discussionStorage"
      name="cidadao-app-discussion-storage"
      value="{{discussions}}"></core-localstorage>
    discussions page
    <div id="newDiscussionForm"
      layout vertical>
      <paper-input id="newDiscussionTopicInput"
         on-change="{{addDiscussion}}"
         value="{{newDiscussionTopic}}"
         floatingLabel
         label="topic"></paper-input>
      <paper-input id="newDiscussionBodyInput"
         on-change="{{addDiscussion}}"
         value="{{newDiscussionBody}}"
         floatingLabel
         label="Add a new discussion"></paper-input>
    </div>
    <template
      repeat="{{discussions}}">
      <div center horizontal layout class="item">
        <paper-checkbox checked="{{done}}"></paper-checkbox>
        <div flex class="card">
          <h1>{{topic}}</h1>
          <p>{{body}}</p>
        </div>
      </div>
      <template
        repeat="{{replies}}">
        replies
      </template>
    </template>
  </template>
  <script>
    (function () {
      Polymer({
        // define element prototype here
        discussions:[],
        ready: function(){
          this.$.newDiscussionForm.style.display = "none";
        },
        showNewDiscussionForm: function(){
          this.$.newDiscussionForm.style.display = "block";
          this.$.newDiscussionTopicInput.focus();
        },
        addDiscussion: function() {
          if (this.newDiscussionTopic && this.newDiscussionBody) {
            this.discussions.unshift({
              topic: this.newDiscussionTopic,
              body: this.newDiscussionBody,
              replies: []
            });
            this.$.newDiscussionForm.style.display = 'none';
            this.$.newDiscussionTopicInput.value = null;
            this.$.newDiscussionBodyInput.value = null;
          }
        },
        discussionsChanged:function(){
          console.log(this.discussions);
          this.$.discussionStorage.save();
        }
      });
    })();
  </script>
</polymer-element>
